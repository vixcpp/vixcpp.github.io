# OpenAPI and Docs UI (offline Swagger)

This module generates an OpenAPI 3 document from your router and serves an offline Swagger UI that works without CDN assets.

It is designed for Vix deployment environments where internet access is limited or fully offline.

## What you get

When enabled, these routes are registered:

- `GET /openapi.json`
  Generated OpenAPI 3.0.3 document (JSON)

- `GET /docs`
  Swagger UI HTML page (uses local assets)

- `GET /docs/`
  Same as `/docs` (no redirect)

- `GET /docs/index.html`
  Same as `/docs` (convenience)

- `GET /docs/swagger-ui.css`
  Embedded Swagger UI CSS (served locally)

- `GET /docs/swagger-ui-bundle.js`
  Embedded Swagger UI JS bundle (served locally)

## Core types

### RouteDoc

`vix::router::RouteDoc` carries documentation metadata for one route:

- `summary` and `description`
- `tags`
- `request_body` (OpenAPI requestBody payload)
- `responses` (OpenAPI responses map)
- `x` (vendor extensions, for example `x-vix-heavy`)

Your router stores this doc next to the route record so OpenAPI generation can read it later.

### OpenAPI Registry

Some modules might not register routes through the core HTTP router, or they want to add docs entries for routes created elsewhere.
`vix::openapi::Registry` is a global registry for extra docs:

- `Registry::add(method, path, doc)`
- `Registry::snapshot()`

During generation, the builder merges:

1) `router.routes()`
2) `Registry::snapshot()`

Duplicate (method, path) entries are automatically ignored.

## Build OpenAPI JSON

Use `vix::openapi::build_from_router(router, title, version)` to generate the OpenAPI document:

```cpp
#include <vix/openapi/OpenApi.hpp>

auto spec = vix::openapi::build_from_router(router, "Vix API", "0.0.0");
// spec is nlohmann::json
```

Notes:
- `operationId` is stable and derived from `method + path`
- if a route has no `responses`, a default `200: OK` response is added
- `RouteDoc::x` is copied as vendor fields into the OpenAPI operation object

## Register the docs routes

Call `register_openapi_and_docs(router, title, version)`:

```cpp
#include <vix/openapi/register_docs.hpp>

vix::openapi::register_openapi_and_docs(*server.getRouter(), "Vix API", "0.0.0");
```

This registers both:
- `/openapi.json`
- `/docs` and local assets under `/docs/*`

## Offline Swagger UI behavior

The HTML returned by `/docs` is generated by:

```cpp
#include <vix/openapi/DocsUI.hpp>

auto html = vix::openapi::swagger_ui_html("/openapi.json");
```

Important implementation details:
- It uses `<base href="/docs/">` so it works for `/docs` and `/docs/`
- CSS and JS are loaded as relative paths: `swagger-ui.css` and `swagger-ui-bundle.js`
- The page fetches `/openapi.json` to display the API title and version in the header
- It sets security headers like `X-Content-Type-Options: nosniff`
- Swagger assets are served with long cache headers (`max-age=31536000, immutable`)

## Heavy routes metadata

If a route is registered with `RouteOptions{ .heavy = true }`, the router injects:

```json
"x-vix-heavy": true
```

into `RouteDoc::x`, so it appears in OpenAPI.
This is useful for tooling or client generation.

## Disable auto docs

If you want to disable docs and OpenAPI generation from the CLI:

```bash
vix run api.cpp --no-docs
```

When `--no-docs` is used, your app should skip calling `register_openapi_and_docs(...)`.

## Minimal integration example

```cpp
#include <vix/server/HTTPServer.hpp>
#include <vix/openapi/register_docs.hpp>

int main()
{
  vix::config::Config cfg;
  auto exec = /* create executor */;

  vix::server::HTTPServer server(cfg, exec);

  // register your API routes here
  auto r = server.getRouter();

  // register docs + openapi
  vix::openapi::register_openapi_and_docs(*r, "Vix API", "0.0.0");

  server.run();
  return 0;
}
```


