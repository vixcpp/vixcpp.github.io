import{_ as s,o as a,c as e,a as t}from"./app.CtA6R87L.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const E=JSON.parse('{"title":"RetryPolicy","description":"","frontmatter":{},"headers":[],"relativePath":"modules/sync/retry_policy.md","filePath":"modules/sync/retry_policy.md","lastUpdated":1771236142000}'),l={name:"modules/sync/retry_policy.md"};function n(p,i,h,r,k,d){return a(),e("div",null,[...i[0]||(i[0]=[t(`<h1 id="retrypolicy" tabindex="-1">RetryPolicy <a class="header-anchor" href="#retrypolicy" aria-label="Permalink to &quot;RetryPolicy&quot;">​</a></h1><p>This page documents the retry policy used in the <code>sync</code> module.</p><p><code>RetryPolicy</code> defines how failed operations are retried over time using deterministic exponential backoff.</p><p>It is:</p><ul><li>Deterministic</li><li>Side-effect free</li><li>Recovery-safe</li><li>Suitable for durable offline-first systems</li></ul><h2 id="header" tabindex="-1">Header <a class="header-anchor" href="#header" aria-label="Permalink to &quot;Header&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/sync/RetryPolicy.hpp&gt;</span></span></code></pre></div><p>Namespace:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::sync</span></span></code></pre></div><h1 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h1><p><code>RetryPolicy</code> controls:</p><ul><li>Maximum number of retry attempts</li><li>Exponential backoff growth</li><li>Maximum delay clamp</li><li>Optional jitter ratio (applied by caller)</li></ul><p>The policy itself does not perform I/O or scheduling. It only computes timing decisions.</p><h1 id="structure" tabindex="-1">Structure <a class="header-anchor" href="#structure" aria-label="Permalink to &quot;Structure&quot;">​</a></h1><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RetryPolicy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_attempts{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base_delay_ms{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_delay_ms{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30&#39;000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factor{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jitter_ratio{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> can_retry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> attempt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compute_delay_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> attempt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h1 id="fields-explained" tabindex="-1">Fields Explained <a class="header-anchor" href="#fields-explained" aria-label="Permalink to &quot;Fields Explained&quot;">​</a></h1><h3 id="max-attempts" tabindex="-1">max_attempts <a class="header-anchor" href="#max-attempts" aria-label="Permalink to &quot;max_attempts&quot;">​</a></h3><p>Maximum number of retry attempts allowed.</p><p>If:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attempt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_attempts</span></span></code></pre></div><p>No further retry should be scheduled.</p><h3 id="base-delay-ms" tabindex="-1">base_delay_ms <a class="header-anchor" href="#base-delay-ms" aria-label="Permalink to &quot;base_delay_ms&quot;">​</a></h3><p>Initial delay before the first retry.</p><p>Default:</p><pre><code>500 ms
</code></pre><h3 id="max-delay-ms" tabindex="-1">max_delay_ms <a class="header-anchor" href="#max-delay-ms" aria-label="Permalink to &quot;max_delay_ms&quot;">​</a></h3><p>Upper clamp for exponential growth.</p><p>Default:</p><pre><code>30 seconds
</code></pre><p>Prevents unbounded retry intervals.</p><h3 id="factor" tabindex="-1">factor <a class="header-anchor" href="#factor" aria-label="Permalink to &quot;factor&quot;">​</a></h3><p>Exponential growth factor.</p><p>Delay evolves as:</p><pre><code>base_delay_ms * (factor ^ attempt)
</code></pre><p>Default:</p><pre><code>2.0
</code></pre><p>Example progression:</p><p>Attempt Delay (ms)</p><hr><p>0 500 1 1000 2 2000 3 4000 4 8000 ... clamped at max_delay_ms</p><h3 id="jitter-ratio" tabindex="-1">jitter_ratio <a class="header-anchor" href="#jitter-ratio" aria-label="Permalink to &quot;jitter_ratio&quot;">​</a></h3><p>Expressed as a fraction:</p><ul><li>0.0 → no jitter</li><li>0.2 → ±20% randomization window</li></ul><p>Important:</p><p>The policy does NOT apply jitter directly.</p><p>It exposes the parameter so higher layers (Outbox or Engine) can apply randomness in a controlled, deterministic-aware manner.</p><h1 id="methods" tabindex="-1">Methods <a class="header-anchor" href="#methods" aria-label="Permalink to &quot;Methods&quot;">​</a></h1><h2 id="can-retry" tabindex="-1">can_retry <a class="header-anchor" href="#can-retry" aria-label="Permalink to &quot;can_retry&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> can_retry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> attempt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Returns true if:</p><pre><code>attempt &lt; max_attempts
</code></pre><h2 id="compute-delay-ms" tabindex="-1">compute_delay_ms <a class="header-anchor" href="#compute-delay-ms" aria-label="Permalink to &quot;compute_delay_ms&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compute_delay_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> attempt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Computes exponential backoff and clamps the result between:</p><ul><li>base_delay_ms</li><li>max_delay_ms</li></ul><p>Behavior:</p><ul><li>attempt 0 → base_delay</li><li>delay grows exponentially</li><li>final value is clamped</li></ul><h1 id="example-usage" tabindex="-1">Example Usage <a class="header-anchor" href="#example-usage" aria-label="Permalink to &quot;Example Usage&quot;">​</a></h1><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RetryPolicy policy;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attempt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">can_retry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(attempt))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> delay </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compute_delay_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(attempt);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> next_retry_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> now_ms </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> delay;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // mark permanent failure</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="deterministic-recovery" tabindex="-1">Deterministic Recovery <a class="header-anchor" href="#deterministic-recovery" aria-label="Permalink to &quot;Deterministic Recovery&quot;">​</a></h1><p>A key design goal:</p><p>Retry timing must be recomputable during recovery.</p><p>Since <code>RetryPolicy</code> is:</p><ul><li>Pure</li><li>Stateless</li><li>Deterministic</li></ul><p>You can replay WAL records and recompute retry windows safely.</p><p>This is essential for:</p><ul><li>Crash recovery</li><li>Outbox reconstruction</li><li>Distributed convergence</li></ul><h1 id="offline-first-considerations" tabindex="-1">Offline-First Considerations <a class="header-anchor" href="#offline-first-considerations" aria-label="Permalink to &quot;Offline-First Considerations&quot;">​</a></h1><p>Exponential backoff prevents:</p><ul><li>Retry storms</li><li>Network flooding</li><li>Thundering herd effects</li></ul><p>The policy ensures:</p><ul><li>Controlled retry growth</li><li>Upper bounded delay</li><li>Predictable behavior</li></ul><h1 id="design-philosophy" tabindex="-1">Design Philosophy <a class="header-anchor" href="#design-philosophy" aria-label="Permalink to &quot;Design Philosophy&quot;">​</a></h1><p>RetryPolicy is:</p><ul><li>Minimal</li><li>Deterministic</li><li>Side-effect free</li><li>Configurable</li><li>Durable-system friendly</li></ul><p>It provides one invariant:</p><blockquote><p>Retry timing must always be recomputable from durable state.</p></blockquote>`,77)])])}const g=s(l,[["render",n]]);export{E as __pageData,g as default};
