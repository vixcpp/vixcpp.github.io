import{_ as i,o as a,c as e,a2 as t}from"./chunks/framework.jUmBZPH5.js";const c=JSON.parse('{"title":"Timers: interval","description":"","frontmatter":{},"headers":[],"relativePath":"modules/core/timers.md","filePath":"modules/core/timers.md","lastUpdated":1770805184000}'),l={name:"modules/core/timers.md"};function n(h,s,p,r,o,k){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="timers-interval" tabindex="-1">Timers: interval <a class="header-anchor" href="#timers-interval" aria-label="Permalink to &quot;Timers: interval&quot;">​</a></h1><p><code>vix::timers::interval()</code> is a tiny utility that runs a repeating timer loop on a dedicated thread, and posts the actual work to an executor.</p><p>This design keeps timing separate from execution:</p><ul><li>the <strong>timer thread</strong> only wakes up and schedules</li><li>the <strong>executor</strong> runs the callback (potentially on a pool)</li></ul><hr><h2 id="files" tabindex="-1">Files <a class="header-anchor" href="#files" aria-label="Permalink to &quot;Files&quot;">​</a></h2><ul><li><code>vix/timers/interval.hpp</code></li></ul><hr><h2 id="key-types" tabindex="-1">Key types <a class="header-anchor" href="#key-types" aria-label="Permalink to &quot;Key types&quot;">​</a></h2><h3 id="vix-timers-intervalhandle" tabindex="-1"><code>vix::timers::IntervalHandle</code> <a class="header-anchor" href="#vix-timers-intervalhandle" aria-label="Permalink to &quot;\`vix::timers::IntervalHandle\`&quot;">​</a></h3><p>RAII handle that owns:</p><ul><li>a shared stop flag (<code>IntervalHandle::State</code>)</li><li>a worker thread that wakes up every period and posts the task</li></ul><p>When the handle is destroyed, it stops the loop and joins the thread.</p><p>Important members:</p><ul><li><code>std::shared_ptr&lt;State&gt; state</code></li><li><code>std::thread t</code></li></ul><p>Important methods:</p><ul><li><code>stopNow()</code> stops and joins (safe to call multiple times)</li><li>destructor calls <code>stopNow()</code> (RAII)</li></ul><hr><h2 id="api" tabindex="-1">API <a class="header-anchor" href="#api" aria-label="Permalink to &quot;API&quot;">​</a></h2><h3 id="intervalhandle-interval-iexecutor-exec-milliseconds-period-function-void-fn-taskoptions-opt" tabindex="-1"><code>IntervalHandle interval(IExecutor&amp; exec, milliseconds period, function&lt;void()&gt; fn, TaskOptions opt = {})</code> <a class="header-anchor" href="#intervalhandle-interval-iexecutor-exec-milliseconds-period-function-void-fn-taskoptions-opt" aria-label="Permalink to &quot;\`IntervalHandle interval(IExecutor&amp; exec, milliseconds period, function&lt;void()&gt; fn, TaskOptions opt = {})\`&quot;">​</a></h3><p>Behavior:</p><ol><li>Creates <code>IntervalHandle</code> with a shared <code>State{stop=false}</code></li><li>Starts a thread that: <ul><li>computes <code>next = now + period</code></li><li>loops: <ul><li>exits if handle is gone or <code>stop=true</code></li><li><code>exec.post(fn, opt)</code></li><li><code>sleep_until(next)</code></li><li><code>next += period</code></li></ul></li></ul></li><li>Returns the handle</li></ol><p>Notes:</p><ul><li>The return handle controls lifetime. If you drop it, the interval stops.</li><li>The callback is posted to <code>exec</code>. It does <strong>not</strong> run on the timer thread.</li><li>The scheduling is “fixed cadence” using <code>sleep_until(next)</code> then <code>next += period</code> to reduce drift.</li></ul><hr><h2 id="typical-usage" tabindex="-1">Typical usage <a class="header-anchor" href="#typical-usage" aria-label="Permalink to &quot;Typical usage&quot;">​</a></h2><h3 id="_1-store-the-handle-in-a-long-lived-owner-server-app" tabindex="-1">1) Store the handle in a long-lived owner (server, app) <a class="header-anchor" href="#_1-store-the-handle-in-a-long-lived-owner-server-app" aria-label="Permalink to &quot;1) Store the handle in a long-lived owner (server, app)&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/timers/interval.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  explicit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IExecutor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> exec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exec_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(exec) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    metrics_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      exec_,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrono</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collectMetrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // TaskOptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    metrics_.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stopNow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // optional; destructor also stops</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> collectMetrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // read counters, log, etc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::IExecutor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec_;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::IntervalHandle metrics_{};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h3 id="_2-stop-explicitly" tabindex="-1">2) Stop explicitly <a class="header-anchor" href="#_2-stop-explicitly" aria-label="Permalink to &quot;2) Stop explicitly&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(exec, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, []{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ... */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stopNow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // stops loop + joins thread</span></span></code></pre></div><hr><h2 id="concurrency-and-safety" tabindex="-1">Concurrency and safety <a class="header-anchor" href="#concurrency-and-safety" aria-label="Permalink to &quot;Concurrency and safety&quot;">​</a></h2><ul><li><code>IntervalHandle</code> is movable, not copyable.</li><li><code>stopNow()</code> is idempotent: <ul><li>sets <code>stop=true</code> if state exists</li><li>joins the thread if joinable</li></ul></li><li>The worker thread captures <code>exec</code> by reference. <ul><li>Make sure <code>exec</code> outlives the interval handle.</li></ul></li><li>The loop uses a <code>weak_ptr</code> to detect handle destruction safely.</li></ul><hr><h2 id="practical-guidance" tabindex="-1">Practical guidance <a class="header-anchor" href="#practical-guidance" aria-label="Permalink to &quot;Practical guidance&quot;">​</a></h2><ul><li>Use it for “background periodic work”: <ul><li>executor metrics logging</li><li>housekeeping tasks</li><li>cache refresh</li></ul></li><li>Keep the posted callback short. If it is heavy, your executor should route it appropriately (priority, heavy routes, separate pool).</li><li>If you need stronger timer semantics (jitter control, cancel callbacks already queued), that logic should live in the executor or in a higher-level scheduler.</li></ul>`,36)])])}const E=i(l,[["render",n]]);export{c as __pageData,E as default};
