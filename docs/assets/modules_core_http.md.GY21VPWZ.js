import{_ as e,o as a,c as i,a as t}from"./app.BhmzGfY0.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const g=JSON.parse('{"title":"HTTP (core)","description":"","frontmatter":{},"headers":[],"relativePath":"modules/core/http.md","filePath":"modules/core/http.md","lastUpdated":1770805184000}'),l={name:"modules/core/http.md"};function n(p,s,d,h,r,o){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="http-core" tabindex="-1">HTTP (core) <a class="header-anchor" href="#http-core" aria-label="Permalink to &quot;HTTP (core)&quot;">​</a></h1><p>This part of <code>core</code> provides the HTTP facade used by Vix apps and the internal adapter layer used by the router/server.</p><p>It includes:</p><ul><li><code>IRequestHandler</code>: a uniform interface used by router/server</li><li><code>Request</code>: a high-level request facade (method, path, params, query, headers, JSON, state)</li><li><code>RequestHandler</code>: an adapter that wraps user handlers into <code>IRequestHandler</code></li><li><code>RequestState</code>: type-safe per-request storage for middleware data sharing</li><li><code>Response</code>: static helpers to build Boost.Beast responses</li><li><code>ResponseWrapper</code>: a friendly fluent API to set status/headers and send text/JSON/files</li><li><code>Status</code>: numeric constants and helpers for HTTP status codes</li></ul><hr><h2 id="irequesthandler" tabindex="-1">IRequestHandler <a class="header-anchor" href="#irequesthandler" aria-label="Permalink to &quot;IRequestHandler&quot;">​</a></h2><p><code>vix::vhttp::IRequestHandler</code> is the low-level interface used by the router/server.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IRequestHandler</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  virtual</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string_body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string_body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  virtual</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ~IRequestHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">noexcept</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>You typically do not implement this directly as an app developer. Vix generates adapters for you via <code>RequestHandler</code>.</p><hr><h2 id="request" tabindex="-1">Request <a class="header-anchor" href="#request" aria-label="Permalink to &quot;Request&quot;">​</a></h2><p><code>vix::vhttp::Request</code> is the developer-facing request facade.</p><p>It wraps a raw Boost.Beast request and exposes:</p><ul><li><code>method()</code></li><li><code>path()</code> (without query string)</li><li><code>target()</code> (original path + query)</li><li><code>params()</code> (route params extracted from patterns like <code>/users/{id}</code>)</li><li><code>query()</code> (lazy query string parsing)</li><li><code>header(name)</code> / <code>has_header(name)</code></li><li><code>body()</code></li><li><code>json()</code> / <code>json_as&lt;T&gt;()</code> (lazy JSON parsing)</li><li><code>RequestState</code> accessors (<code>state&lt;T&gt;()</code>, <code>try_state&lt;T&gt;()</code>, <code>set_state&lt;T&gt;()</code>, ...)</li></ul><h3 id="path-and-query-parsing" tabindex="-1">Path and query parsing <a class="header-anchor" href="#path-and-query-parsing" aria-label="Permalink to &quot;Path and query parsing&quot;">​</a></h3><p>The constructor splits the HTTP target once:</p><ul><li><code>path_</code> gets the part before <code>?</code></li><li><code>query_raw_</code> stores the raw query string part after <code>?</code></li><li><code>query()</code> is parsed lazily on first access</li></ul><h3 id="route-params" tabindex="-1">Route params <a class="header-anchor" href="#route-params" aria-label="Permalink to &quot;Route params&quot;">​</a></h3><p>Route params are provided by the <code>RequestHandler</code> adapter, which matches a route pattern like:</p><ul><li><code>/posts/{id}</code></li><li><code>/users/{userId}/comments/{commentId}</code></li></ul><p>and builds a <code>ParamMap</code>.</p><h3 id="json-caching" tabindex="-1">JSON caching <a class="header-anchor" href="#json-caching" aria-label="Permalink to &quot;JSON caching&quot;">​</a></h3><p><code>json()</code> parses the request body once and caches the result. If the body is empty, it returns <code>{}</code>.</p><hr><h2 id="requeststate" tabindex="-1">RequestState <a class="header-anchor" href="#requeststate" aria-label="Permalink to &quot;RequestState&quot;">​</a></h2><p><code>RequestState</code> is a per-request storage container implemented with:</p><ul><li><code>std::any</code></li><li>keyed by <code>std::type_index</code></li></ul><p>It is designed for middleware to pass strongly-typed data down the chain.</p><p>Example pattern:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string name; };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// middleware:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req.emplace_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AuthUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AuthUser{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Ada&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// handler:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AuthUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>Core API:</p><ul><li><code>emplace&lt;T&gt;(...)</code></li><li><code>set&lt;T&gt;(value)</code></li><li><code>has&lt;T&gt;()</code></li><li><code>get&lt;T&gt;()</code></li><li><code>try_get&lt;T&gt;()</code></li></ul><hr><h2 id="response" tabindex="-1">Response <a class="header-anchor" href="#response" aria-label="Permalink to &quot;Response&quot;">​</a></h2><p><code>vix::vhttp::Response</code> provides static helpers to build common responses on top of Boost.Beast.</p><p>It applies stable defaults like:</p><ul><li><code>Server: Vix/master</code></li><li><code>Date: &lt;RFC7231 GMT date&gt;</code></li></ul><p>It supports:</p><ul><li>JSON message responses (<code>{&quot;message&quot;: &quot;...&quot;}</code>)</li><li>JSON data responses</li><li>plain text responses</li><li>error helpers</li><li>redirects</li></ul><p>Example:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vhttp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json_response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nlohmann</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::json{{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}});</span></span></code></pre></div><h3 id="http-date-formatting" tabindex="-1">HTTP date formatting <a class="header-anchor" href="#http-date-formatting" aria-label="Permalink to &quot;HTTP date formatting&quot;">​</a></h3><p><code>http_date_now()</code> formats a GMT date according to RFC 7231 and uses platform-safe <code>gmtime_*</code> variants.</p><hr><h2 id="responsewrapper" tabindex="-1">ResponseWrapper <a class="header-anchor" href="#responsewrapper" aria-label="Permalink to &quot;ResponseWrapper&quot;">​</a></h2><p><code>vix::vhttp::ResponseWrapper</code> is the fluent developer API used in handlers.</p><p>It wraps:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string_body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&amp;</span></span></code></pre></div><p>and provides:</p><ul><li>status setters (<code>status(int)</code>, <code>status(http::status)</code>, <code>status_c&lt;Code&gt;()</code>)</li><li>header utilities (<code>header</code>, <code>set</code>, <code>append</code>, <code>type</code>)</li><li>send helpers (<code>text</code>, <code>json</code>, <code>send</code>, <code>sendStatus</code>, <code>redirect</code>)</li><li>static file serving (<code>file(path)</code>)</li></ul><h3 id="common-usage" tabindex="-1">Common usage <a class="header-anchor" href="#common-usage" aria-label="Permalink to &quot;Common usage&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/ping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [](</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWrapper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pong&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [](</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWrapper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="auto-default-behavior" tabindex="-1">Auto default behavior <a class="header-anchor" href="#auto-default-behavior" aria-label="Permalink to &quot;Auto default behavior&quot;">​</a></h3><ul><li>If status is not set, it defaults to <code>200 OK</code>.</li><li>For <code>204</code> and <code>304</code>, bodies are cleared automatically.</li><li>If you call <code>send()</code> with no body, it sends a default status text.</li></ul><h3 id="static-files" tabindex="-1">Static files <a class="header-anchor" href="#static-files" aria-label="Permalink to &quot;Static files&quot;">​</a></h3><p><code>file(path)</code>:</p><ul><li>normalizes the path</li><li>rejects <code>..</code> segments (basic traversal protection)</li><li>maps file extensions to MIME types</li><li>serves <code>index.html</code> when <code>path</code> is a directory</li><li>sets <code>Cache-Control</code> if missing</li></ul><hr><h2 id="requesthandler" tabindex="-1">RequestHandler <a class="header-anchor" href="#requesthandler" aria-label="Permalink to &quot;RequestHandler&quot;">​</a></h2><p><code>vix::vhttp::RequestHandler&lt;Handler&gt;</code> is the adapter that:</p><ol><li>extracts <code>path_only</code> (target without query)</li><li>extracts route params based on the route pattern</li><li>creates a <code>RequestState</code></li><li>constructs a <code>Request</code> facade</li><li>invokes the user handler</li><li>sets keep-alive headers and prepares payload</li></ol><h3 id="supported-handler-signatures" tabindex="-1">Supported handler signatures <a class="header-anchor" href="#supported-handler-signatures" aria-label="Permalink to &quot;Supported handler signatures&quot;">​</a></h3><p>Vix supports both facade and raw handlers, and optionally passing route params.</p><p>Facade style (recommended):</p><ul><li><code>void(Request&amp;, ResponseWrapper&amp;)</code></li><li><code>void(Request&amp;, ResponseWrapper&amp;, const Request::ParamMap&amp;)</code></li></ul><p>Raw style (advanced):</p><ul><li><code>void(const RawRequest&amp;, ResponseWrapper&amp;)</code></li><li><code>void(const RawRequest&amp;, ResponseWrapper&amp;, const Request::ParamMap&amp;)</code></li></ul><p>Returnable handlers (auto-send)</p><p>Instead of returning <code>void</code>, a handler may return a value that can be sent.</p><p>Supported return forms:</p><ul><li>payload type accepted by <code>ResponseWrapper::send(payload)</code></li><li><code>std::pair&lt;status, payload&gt;</code></li><li><code>std::tuple&lt;status, payload&gt;</code></li></ul><p>Auto-send only happens when the response body is still empty.</p><h3 id="error-handling" tabindex="-1">Error handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error handling&quot;">​</a></h3><p>The adapter catches:</p><ul><li><code>std::range_error</code> (typically invalid status codes)</li><li><code>std::exception</code></li></ul><p>In debug builds (<code>!NDEBUG</code>), it returns a simple HTML error page with:</p><ul><li>route pattern</li><li>method</li><li>path</li></ul><p>In release builds, it returns a safe JSON error response and logs details using <code>vix::utils::Logger</code>.</p><hr><h2 id="status" tabindex="-1">Status <a class="header-anchor" href="#status" aria-label="Permalink to &quot;Status&quot;">​</a></h2><p><code>vix::vhttp::Status</code> exposes numeric constants for common codes:</p><ul><li><code>OK = 200</code>, <code>CREATED = 201</code>, <code>NO_CONTENT = 204</code>, ...</li><li><code>BAD_REQUEST = 400</code>, <code>NOT_FOUND = 404</code>, ...</li><li><code>INTERNAL_ERROR = 500</code>, ...</li></ul><p>Helpers:</p><ul><li><code>to_status(int)</code> converts <code>100..599</code> to <code>http::status</code> (asserts in debug)</li><li><code>status_to_string(int)</code> returns a human-readable string (e.g. <code>&quot;404 Not Found&quot;</code>)</li></ul><hr><h2 id="practical-guidance" tabindex="-1">Practical guidance <a class="header-anchor" href="#practical-guidance" aria-label="Permalink to &quot;Practical guidance&quot;">​</a></h2><ul><li>Prefer the facade handler style for most apps.</li><li>Use <code>RequestState</code> for middleware to share typed data.</li><li>Use <code>ResponseWrapper</code> for fluent status/headers/send patterns.</li><li>Keep expensive work out of networking threads (use an executor via <code>App</code>).</li></ul>`,87)])])}const E=e(l,[["render",n]]);export{g as __pageData,E as default};
