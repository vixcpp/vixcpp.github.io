import{_ as i,o as e,c as a,a as t}from"./app.CPqzvHAu.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const u=JSON.parse('{"title":"OpenAPI and Docs UI (offline Swagger)","description":"","frontmatter":{},"headers":[],"relativePath":"modules/core/openapi.md","filePath":"modules/core/openapi.md","lastUpdated":1770805184000}'),n={name:"modules/core/openapi.md"};function l(p,s,o,h,d,r){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="openapi-and-docs-ui-offline-swagger" tabindex="-1">OpenAPI and Docs UI (offline Swagger) <a class="header-anchor" href="#openapi-and-docs-ui-offline-swagger" aria-label="Permalink to &quot;OpenAPI and Docs UI (offline Swagger)&quot;">​</a></h1><p>This module generates an OpenAPI 3 document from your router and serves an offline Swagger UI that works without CDN assets.</p><p>It is designed for Vix deployment environments where internet access is limited or fully offline.</p><h2 id="what-you-get" tabindex="-1">What you get <a class="header-anchor" href="#what-you-get" aria-label="Permalink to &quot;What you get&quot;">​</a></h2><p>When enabled, these routes are registered:</p><ul><li><p><code>GET /openapi.json</code> Generated OpenAPI 3.0.3 document (JSON)</p></li><li><p><code>GET /docs</code> Swagger UI HTML page (uses local assets)</p></li><li><p><code>GET /docs/</code> Same as <code>/docs</code> (no redirect)</p></li><li><p><code>GET /docs/index.html</code> Same as <code>/docs</code> (convenience)</p></li><li><p><code>GET /docs/swagger-ui.css</code> Embedded Swagger UI CSS (served locally)</p></li><li><p><code>GET /docs/swagger-ui-bundle.js</code> Embedded Swagger UI JS bundle (served locally)</p></li></ul><h2 id="core-types" tabindex="-1">Core types <a class="header-anchor" href="#core-types" aria-label="Permalink to &quot;Core types&quot;">​</a></h2><h3 id="routedoc" tabindex="-1">RouteDoc <a class="header-anchor" href="#routedoc" aria-label="Permalink to &quot;RouteDoc&quot;">​</a></h3><p><code>vix::router::RouteDoc</code> carries documentation metadata for one route:</p><ul><li><code>summary</code> and <code>description</code></li><li><code>tags</code></li><li><code>request_body</code> (OpenAPI requestBody payload)</li><li><code>responses</code> (OpenAPI responses map)</li><li><code>x</code> (vendor extensions, for example <code>x-vix-heavy</code>)</li></ul><p>Your router stores this doc next to the route record so OpenAPI generation can read it later.</p><h3 id="openapi-registry" tabindex="-1">OpenAPI Registry <a class="header-anchor" href="#openapi-registry" aria-label="Permalink to &quot;OpenAPI Registry&quot;">​</a></h3><p>Some modules might not register routes through the core HTTP router, or they want to add docs entries for routes created elsewhere. <code>vix::openapi::Registry</code> is a global registry for extra docs:</p><ul><li><code>Registry::add(method, path, doc)</code></li><li><code>Registry::snapshot()</code></li></ul><p>During generation, the builder merges:</p><ol><li><code>router.routes()</code></li><li><code>Registry::snapshot()</code></li></ol><p>Duplicate (method, path) entries are automatically ignored.</p><h2 id="build-openapi-json" tabindex="-1">Build OpenAPI JSON <a class="header-anchor" href="#build-openapi-json" aria-label="Permalink to &quot;Build OpenAPI JSON&quot;">​</a></h2><p>Use <code>vix::openapi::build_from_router(router, title, version)</code> to generate the OpenAPI document:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/openapi/OpenApi.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> spec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openapi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build_from_router</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(router, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Vix API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// spec is nlohmann::json</span></span></code></pre></div><p>Notes:</p><ul><li><code>operationId</code> is stable and derived from <code>method + path</code></li><li>if a route has no <code>responses</code>, a default <code>200: OK</code> response is added</li><li><code>RouteDoc::x</code> is copied as vendor fields into the OpenAPI operation object</li></ul><h2 id="register-the-docs-routes" tabindex="-1">Register the docs routes <a class="header-anchor" href="#register-the-docs-routes" aria-label="Permalink to &quot;Register the docs routes&quot;">​</a></h2><p>Call <code>register_openapi_and_docs(router, title, version)</code>:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/openapi/register_docs.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openapi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register_openapi_and_docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Vix API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>This registers both:</p><ul><li><code>/openapi.json</code></li><li><code>/docs</code> and local assets under <code>/docs/*</code></li></ul><h2 id="offline-swagger-ui-behavior" tabindex="-1">Offline Swagger UI behavior <a class="header-anchor" href="#offline-swagger-ui-behavior" aria-label="Permalink to &quot;Offline Swagger UI behavior&quot;">​</a></h2><p>The HTML returned by <code>/docs</code> is generated by:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/openapi/DocsUI.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openapi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">swagger_ui_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/openapi.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Important implementation details:</p><ul><li>It uses <code>&lt;base href=&quot;/docs/&quot;&gt;</code> so it works for <code>/docs</code> and <code>/docs/</code></li><li>CSS and JS are loaded as relative paths: <code>swagger-ui.css</code> and <code>swagger-ui-bundle.js</code></li><li>The page fetches <code>/openapi.json</code> to display the API title and version in the header</li><li>It sets security headers like <code>X-Content-Type-Options: nosniff</code></li><li>Swagger assets are served with long cache headers (<code>max-age=31536000, immutable</code>)</li></ul><h2 id="heavy-routes-metadata" tabindex="-1">Heavy routes metadata <a class="header-anchor" href="#heavy-routes-metadata" aria-label="Permalink to &quot;Heavy routes metadata&quot;">​</a></h2><p>If a route is registered with <code>RouteOptions{ .heavy = true }</code>, the router injects:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-vix-heavy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>into <code>RouteDoc::x</code>, so it appears in OpenAPI. This is useful for tooling or client generation.</p><h2 id="disable-auto-docs" tabindex="-1">Disable auto docs <a class="header-anchor" href="#disable-auto-docs" aria-label="Permalink to &quot;Disable auto docs&quot;">​</a></h2><p>If you want to disable docs and OpenAPI generation from the CLI:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api.cpp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-docs</span></span></code></pre></div><p>When <code>--no-docs</code> is used, your app should skip calling <code>register_openapi_and_docs(...)</code>.</p><h2 id="minimal-integration-example" tabindex="-1">Minimal integration example <a class="header-anchor" href="#minimal-integration-example" aria-label="Permalink to &quot;Minimal integration example&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/server/HTTPServer.hpp&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/openapi/register_docs.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Config cfg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* create executor */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::HTTPServer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, exec);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // register your API routes here</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // register docs + openapi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openapi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register_openapi_and_docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Vix API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,42)])])}const E=i(n,[["render",l]]);export{u as __pageData,E as default};
