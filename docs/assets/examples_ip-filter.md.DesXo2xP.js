import{_ as i,o as a,c as e,a as t}from"./app.Dt0WhiM7.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const E=JSON.parse('{"title":"IP Filter (Beginner Guide)","description":"","frontmatter":{},"headers":[],"relativePath":"examples/ip-filter.md","filePath":"examples/ip-filter.md","lastUpdated":1771331966000}'),l={name:"examples/ip-filter.md"};function n(h,s,p,r,k,o){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="ip-filter-beginner-guide" tabindex="-1">IP Filter (Beginner Guide) <a class="header-anchor" href="#ip-filter-beginner-guide" aria-label="Permalink to &quot;IP Filter (Beginner Guide)&quot;">â€‹</a></h1><p>Welcome ðŸ‘‹<br> This page explains how to protect routes using the <strong>IP filter middleware</strong> in Vix.cpp.</p><p>With an IP filter you can:</p><ul><li>allow only trusted IPs (allowlist)</li><li>block known bad IPs (denylist)</li><li>protect <code>/api/*</code> while keeping public routes open</li></ul><h2 id="what-is-an-ip-filter" tabindex="-1">What is an IP filter? <a class="header-anchor" href="#what-is-an-ip-filter" aria-label="Permalink to &quot;What is an IP filter?&quot;">â€‹</a></h2><p>An IP filter checks the client IP address <strong>before</strong> your route handler runs.</p><p>If the IP is not allowed, the middleware stops the request early and returns:</p><ul><li><strong>403 Forbidden</strong></li></ul><h2 id="where-does-the-server-get-the-client-ip" tabindex="-1">Where does the server get the client IP? <a class="header-anchor" href="#where-does-the-server-get-the-client-ip" aria-label="Permalink to &quot;Where does the server get the client IP?&quot;">â€‹</a></h2><p>In real production deployments you usually have a reverse proxy (Nginx, cloud load balancer).<br> That proxy sends the client IP through headers such as:</p><ul><li><code>X-Forwarded-For</code> (most common)</li><li><code>X-Real-IP</code></li></ul><p>When <code>X-Forwarded-For</code> contains multiple values like:</p><pre><code>client, proxy1, proxy2
</code></pre><p>Vix uses the <strong>first IP</strong> (the real client).</p><h1 id="_1-minimal-ip-filter-on-api" tabindex="-1">1) Minimal IP filter on <code>/api/*</code> <a class="header-anchor" href="#_1-minimal-ip-filter-on-api" aria-label="Permalink to &quot;1) Minimal IP filter on \`/api/*\`&quot;">â€‹</a></h1><p>This example:</p><ul><li>keeps <code>/</code> public</li><li>protects <code>/api/hello</code></li><li>allows only <code>10.0.0.1</code> and <code>127.0.0.1</code></li><li>explicitly denies <code>9.9.9.9</code> (deny wins)</li></ul><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix.hpp&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/middleware/app/presets.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  App app;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Apply on /api/*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip_filter_allow_deny_dev</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      &quot;x-forwarded-for&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // allow</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9.9.9.9&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               // deny (priority)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       // fallback to x-real-ip, etc.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      ));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [](</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;public route&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [](</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello from /api/hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;x_forwarded_for&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-forwarded-for&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;x_real_ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-real-ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_2-test-with-curl" tabindex="-1">2) Test with curl <a class="header-anchor" href="#_2-test-with-curl" aria-label="Permalink to &quot;2) Test with curl&quot;">â€‹</a></h1><p>Start:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip_filter_server.cpp</span></span></code></pre></div><p>Public route (no middleware):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/</span></span></code></pre></div><p>Allowed IP:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Forwarded-For: 10.0.0.1&quot;</span></span></code></pre></div><p>Not allowed (not in allow list):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Forwarded-For: 1.2.3.4&quot;</span></span></code></pre></div><p>Denied explicitly (deny wins):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Forwarded-For: 9.9.9.9&quot;</span></span></code></pre></div><p>X-Forwarded-For chain:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Forwarded-For: 10.0.0.1, 127.0.0.1&quot;</span></span></code></pre></div><h1 id="_3-common-beginner-mistakes" tabindex="-1">3) Common beginner mistakes <a class="header-anchor" href="#_3-common-beginner-mistakes" aria-label="Permalink to &quot;3) Common beginner mistakes&quot;">â€‹</a></h1><h2 id="mistake-1-trusting-x-forwarded-for-directly-on-the-internet" tabindex="-1">Mistake 1: trusting X-Forwarded-For directly on the internet <a class="header-anchor" href="#mistake-1-trusting-x-forwarded-for-directly-on-the-internet" aria-label="Permalink to &quot;Mistake 1: trusting X-Forwarded-For directly on the internet&quot;">â€‹</a></h2><p>If your server is directly exposed (no proxy), attackers can forge headers.</p><p>Production rule:</p><ul><li>only trust <code>X-Forwarded-For</code> if it comes from a trusted proxy</li><li>otherwise use remote address (socket IP) or <code>X-Real-IP</code> set by your proxy</li></ul><h2 id="mistake-2-forgetting-that-allowlist-blocks-everything-else" tabindex="-1">Mistake 2: forgetting that allowlist blocks everything else <a class="header-anchor" href="#mistake-2-forgetting-that-allowlist-blocks-everything-else" aria-label="Permalink to &quot;Mistake 2: forgetting that allowlist blocks everything else&quot;">â€‹</a></h2><p>If you configure an allow list, any IP not in it is blocked.</p><h2 id="mistake-3-wrong-header-name" tabindex="-1">Mistake 3: wrong header name <a class="header-anchor" href="#mistake-3-wrong-header-name" aria-label="Permalink to &quot;Mistake 3: wrong header name&quot;">â€‹</a></h2><p>Your middleware reads the header you give it.</p><p>If you configured:</p><ul><li><code>&quot;x-forwarded-for&quot;</code></li></ul><p>Then your requests must send:</p><ul><li><code>X-Forwarded-For: ...</code></li></ul><p>Header names are case-insensitive in HTTP, but spelling must match.</p><h1 id="_4-when-to-use-allow-deny-or-both" tabindex="-1">4) When to use allow, deny, or both <a class="header-anchor" href="#_4-when-to-use-allow-deny-or-both" aria-label="Permalink to &quot;4) When to use allow, deny, or both&quot;">â€‹</a></h1><ul><li><strong>Allow only</strong>: admin dashboards, internal APIs, webhooks from known providers</li><li><strong>Deny only</strong>: block a list of abusive IPs</li><li><strong>Allow + deny</strong>: allow trusted range but always block specific offenders (deny priority)</li></ul><h1 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">â€‹</a></h1><ul><li>Install IP filter on a prefix: <code>app.use(&quot;/api&quot;, ...)</code></li><li>Use allowlist for strict protection</li><li>Use denylist for explicit blocks</li><li>Prefer running behind a proxy that sets <code>X-Forwarded-For</code> safely</li></ul>`,49)])])}const u=i(l,[["render",n]]);export{E as __pageData,u as default};
