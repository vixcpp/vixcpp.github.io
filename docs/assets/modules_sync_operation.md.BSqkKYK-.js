import{_ as s,o as a,c as e,a as t}from"./app.BAYJ8JJN.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const u=JSON.parse('{"title":"Operation","description":"","frontmatter":{},"headers":[],"relativePath":"modules/sync/operation.md","filePath":"modules/sync/operation.md","lastUpdated":1771236142000}'),n={name:"modules/sync/operation.md"};function l(p,i,h,r,d,o){return a(),e("div",null,[...i[0]||(i[0]=[t(`<h1 id="operation" tabindex="-1">Operation <a class="header-anchor" href="#operation" aria-label="Permalink to &quot;Operation&quot;">​</a></h1><p>This page documents the <code>Operation</code> type in the <code>sync</code> module.</p><p><code>Operation</code> is the fundamental durable unit flowing through:</p><ul><li>WAL</li><li>Outbox</li><li>SyncEngine</li><li>Transport layer</li></ul><p>It represents <strong>what must be done</strong>, while its lifecycle fields track <strong>how it evolves over time</strong>.</p><h2 id="header" tabindex="-1">Header <a class="header-anchor" href="#header" aria-label="Permalink to &quot;Header&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/sync/Operation.hpp&gt;</span></span></code></pre></div><p>Namespace:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::sync</span></span></code></pre></div><h1 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h1><p>An <code>Operation</code> is:</p><ul><li>Immutable in intent (kind, target, payload)</li><li>Mutable in lifecycle state (status, attempts, timestamps)</li><li>Persisted durably before any network effect</li><li>Replay-safe and recovery-friendly</li></ul><p>It is designed for offline-first correctness.</p><h1 id="operationstatus" tabindex="-1">OperationStatus <a class="header-anchor" href="#operationstatus" aria-label="Permalink to &quot;OperationStatus&quot;">​</a></h1><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OperationStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint8_t</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Pending</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    InFlight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Failed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    PermanentFailed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h3 id="meaning" tabindex="-1">Meaning <a class="header-anchor" href="#meaning" aria-label="Permalink to &quot;Meaning&quot;">​</a></h3><ul><li><strong>Pending</strong>: persisted, waiting to be processed</li><li><strong>InFlight</strong>: claimed and currently being processed</li><li><strong>Done</strong>: successfully completed</li><li><strong>Failed</strong>: failed but may be retried</li><li><strong>PermanentFailed</strong>: failed permanently, no more retries</li></ul><p>This status is durable and drives retry logic.</p><h1 id="operation-structure" tabindex="-1">Operation Structure <a class="header-anchor" href="#operation-structure" aria-label="Permalink to &quot;Operation Structure&quot;">​</a></h1><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Operation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string id;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string kind;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string target;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string payload;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string idempotency_key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at_ms{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updated_at_ms{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attempt{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> next_retry_at_ms{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OperationStatus status{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OperationStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Pending};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string last_error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h1 id="fields-explained" tabindex="-1">Fields Explained <a class="header-anchor" href="#fields-explained" aria-label="Permalink to &quot;Fields Explained&quot;">​</a></h1><h3 id="id" tabindex="-1">id <a class="header-anchor" href="#id" aria-label="Permalink to &quot;id&quot;">​</a></h3><p>Unique identifier for the operation.</p><p>Generated automatically by Outbox when configured.</p><h3 id="kind" tabindex="-1">kind <a class="header-anchor" href="#kind" aria-label="Permalink to &quot;kind&quot;">​</a></h3><p>Logical category of operation.</p><p>Examples:</p><ul><li><code>&quot;http.request&quot;</code></li><li><code>&quot;p2p.message&quot;</code></li><li><code>&quot;db.mutation&quot;</code></li></ul><h3 id="target" tabindex="-1">target <a class="header-anchor" href="#target" aria-label="Permalink to &quot;target&quot;">​</a></h3><p>Destination or logical target.</p><p>Examples:</p><ul><li>URL</li><li>Peer ID</li><li>Resource name</li></ul><h3 id="payload" tabindex="-1">payload <a class="header-anchor" href="#payload" aria-label="Permalink to &quot;payload&quot;">​</a></h3><p>Opaque serialized data required to execute the operation.</p><p>Interpretation depends on transport or higher layer.</p><h3 id="idempotency-key" tabindex="-1">idempotency_key <a class="header-anchor" href="#idempotency-key" aria-label="Permalink to &quot;idempotency_key&quot;">​</a></h3><p>Used to deduplicate retries on the remote side.</p><p>Ensures that repeated delivery does not cause duplicate effects.</p><h3 id="created-at-ms" tabindex="-1">created_at_ms <a class="header-anchor" href="#created-at-ms" aria-label="Permalink to &quot;created_at_ms&quot;">​</a></h3><p>Timestamp when operation was created.</p><h3 id="updated-at-ms" tabindex="-1">updated_at_ms <a class="header-anchor" href="#updated-at-ms" aria-label="Permalink to &quot;updated_at_ms&quot;">​</a></h3><p>Timestamp of last lifecycle transition.</p><h3 id="attempt" tabindex="-1">attempt <a class="header-anchor" href="#attempt" aria-label="Permalink to &quot;attempt&quot;">​</a></h3><p>Number of delivery attempts performed so far.</p><p>Incremented when retrying.</p><h3 id="next-retry-at-ms" tabindex="-1">next_retry_at_ms <a class="header-anchor" href="#next-retry-at-ms" aria-label="Permalink to &quot;next_retry_at_ms&quot;">​</a></h3><p>Time when the operation becomes eligible for retry.</p><p>Computed using RetryPolicy.</p><h3 id="status" tabindex="-1">status <a class="header-anchor" href="#status" aria-label="Permalink to &quot;status&quot;">​</a></h3><p>Current durable lifecycle state.</p><h3 id="last-error" tabindex="-1">last_error <a class="header-anchor" href="#last-error" aria-label="Permalink to &quot;last_error&quot;">​</a></h3><p>Most recent error message, if any.</p><p>Used for diagnostics and logging.</p><h1 id="lifecycle-helpers" tabindex="-1">Lifecycle Helpers <a class="header-anchor" href="#lifecycle-helpers" aria-label="Permalink to &quot;Lifecycle Helpers&quot;">​</a></h1><h2 id="is-done" tabindex="-1">is_done() <a class="header-anchor" href="#is-done" aria-label="Permalink to &quot;is_done()&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is_done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Returns true if status == Done.</p><h2 id="is-pending" tabindex="-1">is_pending() <a class="header-anchor" href="#is-pending" aria-label="Permalink to &quot;is_pending()&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is_pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Returns true if status == Pending.</p><h2 id="is-failed" tabindex="-1">is_failed() <a class="header-anchor" href="#is-failed" aria-label="Permalink to &quot;is_failed()&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> is_failed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Returns true if status == Failed.</p><h2 id="fail" tabindex="-1">fail() <a class="header-anchor" href="#fail" aria-label="Permalink to &quot;fail()&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> now_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Transitions operation to:</p><pre><code>status = Failed
</code></pre><p>Updates:</p><ul><li>last_error</li><li>updated_at_ms</li></ul><p>Retry scheduling is handled by Outbox using RetryPolicy.</p><h2 id="done" tabindex="-1">done() <a class="header-anchor" href="#done" aria-label="Permalink to &quot;done()&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> now_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Transitions operation to:</p><pre><code>status = Done
</code></pre><p>Clears:</p><ul><li>last_error</li></ul><h1 id="typical-lifecycle-flow" tabindex="-1">Typical Lifecycle Flow <a class="header-anchor" href="#typical-lifecycle-flow" aria-label="Permalink to &quot;Typical Lifecycle Flow&quot;">​</a></h1><ol><li>Operation created</li><li>Persisted in Outbox (status = Pending)</li><li>Claimed (status = InFlight)</li><li>Delivered successfully → Done or</li><li>Failed → Failed → scheduled retry</li><li>Exceeded retry attempts → PermanentFailed</li></ol><p>All transitions are durable.</p><h1 id="offline-first-guarantees" tabindex="-1">Offline-First Guarantees <a class="header-anchor" href="#offline-first-guarantees" aria-label="Permalink to &quot;Offline-First Guarantees&quot;">​</a></h1><p>Operation enables:</p><ul><li>Crash-safe retries</li><li>Idempotent delivery</li><li>Deterministic replay</li><li>Durable state reconstruction</li></ul><p>It is the atomic unit of convergence in the sync system.</p><h1 id="design-philosophy" tabindex="-1">Design Philosophy <a class="header-anchor" href="#design-philosophy" aria-label="Permalink to &quot;Design Philosophy&quot;">​</a></h1><p>Operation is:</p><ul><li>Simple</li><li>Durable</li><li>Deterministic</li><li>Explicit</li><li>Policy-driven (RetryPolicy + Outbox)</li></ul><p>One invariant:</p><blockquote><p>An operation&#39;s intent never changes, only its lifecycle state evolves.</p></blockquote>`,88)])])}const y=s(n,[["render",l]]);export{u as __pageData,y as default};
