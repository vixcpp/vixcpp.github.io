import{_ as i,o as e,c as a,a as t}from"./app.BJZzkuRh.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const E=JSON.parse('{"title":"expected","description":"","frontmatter":{},"headers":[],"relativePath":"modules/conversion/expected.md","filePath":"modules/conversion/expected.md","lastUpdated":1771056697000}'),n={name:"modules/conversion/expected.md"};function l(p,s,h,d,r,o){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="expected" tabindex="-1">expected <a class="header-anchor" href="#expected" aria-label="Permalink to &quot;expected&quot;">​</a></h1><p><code>expected&lt;T, E&gt;</code> is the error-handling primitive used by Vix conversion APIs.</p><p>It provides a predictable alternative to exceptions and integrates cleanly with strict parsing functions like <code>to_int</code>, <code>to_float</code>, and <code>to_enum</code>.</p><h2 id="header" tabindex="-1">Header <a class="header-anchor" href="#header" aria-label="Permalink to &quot;Header&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vix/conversion/Expected.hpp&gt;</span></span></code></pre></div><p>Namespace:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::conversion</span></span></code></pre></div><h2 id="why-vix-has-its-own-expected" tabindex="-1">Why Vix Has Its Own expected <a class="header-anchor" href="#why-vix-has-its-own-expected" aria-label="Permalink to &quot;Why Vix Has Its Own expected&quot;">​</a></h2><p>Vix conversion targets <strong>C++20</strong>, but <code>std::expected</code> is a <strong>C++23</strong> feature.</p><p>This header provides a single abstraction:</p><ul><li>Use <code>std::expected</code> when the standard library actually supports it</li><li>Otherwise use a small C++20 fallback that implements the minimal API Vix needs</li></ul><p>This guarantees the same public API for conversions across toolchains and language modes.</p><h2 id="when-std-expected-is-used" tabindex="-1">When std::expected Is Used <a class="header-anchor" href="#when-std-expected-is-used" aria-label="Permalink to &quot;When std::expected Is Used&quot;">​</a></h2><p>Vix will alias <code>std::expected</code> only if:</p><ul><li><code>&lt;expected&gt;</code> header exists</li><li>The library feature macro <code>__cpp_lib_expected</code> is defined</li><li><code>__cpp_lib_expected &gt;= 202202L</code></li></ul><p>When those conditions are met:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typename</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typename</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typename</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unexpected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unexpected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span></code></pre></div><p>Otherwise, Vix uses its fallback types.</p><h2 id="constexpr-behavior" tabindex="-1">constexpr Behavior <a class="header-anchor" href="#constexpr-behavior" aria-label="Permalink to &quot;constexpr Behavior&quot;">​</a></h2><p>In C++23 mode with <code>std::expected</code>, functions returning <code>expected</code> can be <code>constexpr</code>.</p><p>In fallback mode (C++20), the type is not a literal type, so <code>constexpr</code> would warn.</p><p>Vix standardizes this using:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VIX_CONVERSION_EXPECTED_IS_STD</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VIX_EXPECTED_CONSTEXPR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> constexpr</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VIX_EXPECTED_CONSTEXPR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> inline</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span></span></code></pre></div><p>So conversion APIs can write:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nodiscard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">]]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VIX_EXPECTED_CONSTEXPR expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ConversionError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string_view input) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">noexcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="public-api-surface" tabindex="-1">Public API Surface <a class="header-anchor" href="#public-api-surface" aria-label="Permalink to &quot;Public API Surface&quot;">​</a></h2><p>The Vix fallback is intentionally minimal. It supports only what conversion code needs.</p><h3 id="expected-t-e" tabindex="-1">expected&lt;T, E&gt; <a class="header-anchor" href="#expected-t-e" aria-label="Permalink to &quot;expected\\&lt;T, E\\&gt;&quot;">​</a></h3><p>Main operations:</p><ul><li><code>has_value()</code></li><li><code>operator bool()</code></li><li><code>value()</code> accessors</li><li><code>error()</code> accessors</li></ul><h3 id="unexpected-e" tabindex="-1">unexpected<code>&lt;E&gt;</code> <a class="header-anchor" href="#unexpected-e" aria-label="Permalink to &quot;unexpected\`&lt;E&gt;\`{=html}&quot;">​</a></h3><p>Used to carry an error value:</p><ul><li><code>error()</code> accessors</li><li><code>make_unexpected(E)</code> helper</li></ul><h2 id="basic-usage-pattern" tabindex="-1">Basic Usage Pattern <a class="header-anchor" href="#basic-usage-pattern" aria-label="Permalink to &quot;Basic Usage Pattern&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">conversion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_float64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3.14&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // failure path</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // inspect err.code, err.input, etc.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// success path</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>This style is:</p><ul><li>explicit</li><li>branch-friendly</li><li>exception-free</li><li>easy to propagate</li></ul><h2 id="creating-errors-with-make-unexpected" tabindex="-1">Creating Errors with make_unexpected <a class="header-anchor" href="#creating-errors-with-make-unexpected" aria-label="Permalink to &quot;Creating Errors with make_unexpected&quot;">​</a></h2><p>Vix provides a helper to build <code>unexpected&lt;E&gt;</code> consistently:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make_unexpected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ConversionError{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ConversionErrorCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::InvalidFloat,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>This works in both modes:</p><ul><li>std::expected mode</li><li>fallback mode</li></ul><h2 id="notes-about-the-fallback-implementation" tabindex="-1">Notes About the Fallback Implementation <a class="header-anchor" href="#notes-about-the-fallback-implementation" aria-label="Permalink to &quot;Notes About the Fallback Implementation&quot;">​</a></h2><p>The fallback <code>expected&lt;T, E&gt;</code> is implemented as:</p><ul><li>A union storing either <code>T</code> or <code>E</code></li><li>A boolean flag <code>has_</code> that selects which member is active</li><li>Placement-new constructors</li><li>A destructor that destroys the active member</li><li><code>assert(...)</code> guards on <code>value()</code> and <code>error()</code> access</li></ul><p>Important behavior:</p><ul><li><code>value()</code> asserts that the expected holds a value</li><li><code>error()</code> asserts that the expected holds an error</li></ul><p>This matches the &quot;debug-checked&quot; style used in Vix: if you misuse the API, you get a clear assertion failure during development.</p><h2 id="design-philosophy" tabindex="-1">Design Philosophy <a class="header-anchor" href="#design-philosophy" aria-label="Permalink to &quot;Design Philosophy&quot;">​</a></h2><p>Vix conversion APIs are strict.</p><p>So error handling must be:</p><ul><li>explicit</li><li>typed</li><li>predictable</li><li>portable across C++20 and C++23</li></ul><p><code>expected&lt;T, E&gt;</code> is the foundation that enables this style.</p>`,53)])])}const u=i(n,[["render",l]]);export{E as __pageData,u as default};
