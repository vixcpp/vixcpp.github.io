import{_ as a,o as s,c as e,a as t}from"./app.BYdyB00j.js";import"./chunks/markjs.l6TISjdC.js";import"./chunks/minisearch.DigTKvvb.js";const g=JSON.parse('{"title":"Router (core)","description":"","frontmatter":{},"headers":[],"relativePath":"modules/core/router.md","filePath":"modules/core/router.md","lastUpdated":1770805184000}'),n={name:"modules/core/router.md"};function l(r,i,h,o,p,d){return s(),e("div",null,[...i[0]||(i[0]=[t(`<h1 id="router-core" tabindex="-1">Router (core) <a class="header-anchor" href="#router-core" aria-label="Permalink to &quot;Router (core)&quot;">​</a></h1><p>The <strong>Vix Router</strong> is a lightweight HTTP route matcher and dispatcher.</p><p>It is designed for:</p><ul><li>High-performance method + path matching</li><li>Tree-based routing (segment by segment)</li><li>Path parameters (<code>/users/{id}</code>)</li><li>HEAD → GET fallback</li><li>Automatic 404 handling</li><li>Optional OpenAPI metadata</li><li>Heavy route scheduling hints</li></ul><hr><h2 id="design-philosophy" tabindex="-1">Design Philosophy <a class="header-anchor" href="#design-philosophy" aria-label="Permalink to &quot;Design Philosophy&quot;">​</a></h2><p>The router is:</p><ul><li>Deterministic</li><li>Allocation-conscious</li><li>Tree-backed (not regex-based)</li><li>HTTP verb aware</li><li>Compatible with OpenAPI generation</li></ul><p>It separates:</p><ul><li>Routing (matching)</li><li>Handling (IRequestHandler)</li><li>Scheduling hints (<code>heavy</code> routes)</li><li>Documentation metadata (<code>RouteDoc</code>)</li></ul><hr><h2 id="basic-route-registration" tabindex="-1">Basic Route Registration <a class="header-anchor" href="#basic-route-registration" aria-label="Permalink to &quot;Basic Route Registration&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">verb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::get,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  handler_ptr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>You can also attach options and documentation:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">verb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::post,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;/users/{id}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  handler_ptr,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  RouteOptions{ .heavy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  RouteDoc{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .summary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Update user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .description </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Updates user profile by ID&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><hr><h2 id="route-tree-model" tabindex="-1">Route Tree Model <a class="header-anchor" href="#route-tree-model" aria-label="Permalink to &quot;Route Tree Model&quot;">​</a></h2><p>Internally, the router builds a <strong>segment tree</strong>.</p><p>Example:</p><pre><code>GET/users/{id}
</code></pre><p>Is stored as:</p><pre><code>root
 └── GET
      └── users
           └── *
</code></pre><p>Parameter segments are stored as <code>&quot;*&quot;</code> internally.</p><hr><h2 id="path-parameters" tabindex="-1">Path Parameters <a class="header-anchor" href="#path-parameters" aria-label="Permalink to &quot;Path Parameters&quot;">​</a></h2><p>A segment written as:</p><pre><code>/users/{id}
</code></pre><p>Is marked as:</p><ul><li><code>isParam = true</code></li><li><code>paramName = &quot;id&quot;</code></li></ul><p>The router matches dynamic segments safely without regex overhead.</p><hr><h2 id="heavy-routes" tabindex="-1">Heavy Routes <a class="header-anchor" href="#heavy-routes" aria-label="Permalink to &quot;Heavy Routes&quot;">​</a></h2><p>Routes can be marked as:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RouteOptions{ .heavy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><p>This allows:</p><ul><li>Dedicated executor scheduling</li><li>CPU/DB-intensive isolation</li><li>Runtime scheduling decisions</li></ul><p>You can check at runtime:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is_heavy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><hr><h2 id="head-fallback" tabindex="-1">HEAD Fallback <a class="header-anchor" href="#head-fallback" aria-label="Permalink to &quot;HEAD Fallback&quot;">​</a></h2><p>If a <code>HEAD</code> request is received and no HEAD route exists:</p><ul><li>The router automatically attempts to match <code>GET</code></li><li>The response body is stripped</li><li>Content-Length is preserved</li></ul><p>This follows standard HTTP semantics.</p><hr><h2 id="options-handling" tabindex="-1">OPTIONS Handling <a class="header-anchor" href="#options-handling" aria-label="Permalink to &quot;OPTIONS Handling&quot;">​</a></h2><p>If no explicit OPTIONS route is defined:</p><ul><li>Router returns <code>204 No Content</code></li><li>Connection is closed</li><li>Empty body</li></ul><hr><h2 id="_404-handling" tabindex="-1">404 Handling <a class="header-anchor" href="#_404-handling" aria-label="Permalink to &quot;404 Handling&quot;">​</a></h2><p>If no route matches:</p><ul><li>Custom handler (if defined) is used</li><li>Otherwise, default JSON response:</li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Route not found&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/unknown&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="openapi-integration" tabindex="-1">OpenAPI Integration <a class="header-anchor" href="#openapi-integration" aria-label="Permalink to &quot;OpenAPI Integration&quot;">​</a></h2><p>Each route can register metadata via <code>RouteDoc</code>:</p><ul><li>summary</li><li>description</li><li>tags</li><li>request_body schema</li><li>responses</li><li>vendor extensions</li></ul><p>You can retrieve all registered routes:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">routes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>This enables:</p><ul><li>OpenAPI generation</li><li>Runtime validation</li><li>Documentation tools</li></ul><hr><h2 id="matching-rules" tabindex="-1">Matching Rules <a class="header-anchor" href="#matching-rules" aria-label="Permalink to &quot;Matching Rules&quot;">​</a></h2><p>Matching priority:</p><ol><li>Exact segment match</li><li>Parameter match (<code>*</code>)</li><li>Otherwise → no match</li></ol><p>Method is part of the tree key (<code>GET/users</code> is different from <code>POST/users</code>).</p><hr><h2 id="guarantees" tabindex="-1">Guarantees <a class="header-anchor" href="#guarantees" aria-label="Permalink to &quot;Guarantees&quot;">​</a></h2><p>The Router guarantees:</p><ul><li>Single-pass matching</li><li>No regex overhead</li><li>Deterministic behavior</li><li>Safe handling of HEAD and OPTIONS</li><li>Query string stripping during match</li><li>Clean separation between routing and execution</li></ul><hr><h2 id="when-to-use" tabindex="-1">When To Use <a class="header-anchor" href="#when-to-use" aria-label="Permalink to &quot;When To Use&quot;">​</a></h2><p>Use Router when:</p><ul><li>Building REST APIs</li><li>Generating OpenAPI specs</li><li>Managing heavy vs light routes</li><li>Requiring deterministic high-performance matching</li></ul><hr><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>The Vix Router is:</p><ul><li>Tree-based</li><li>Verb-aware</li><li>Parameter-capable</li><li>Documentation-ready</li><li>Scheduling-aware</li></ul><p>It forms the backbone of the Vix HTTP runtime.</p>`,78)])])}const E=a(n,[["render",l]]);export{g as __pageData,E as default};
